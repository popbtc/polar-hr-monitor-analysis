<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Polar HR Receiver Dashboard</title>
    <style>
        :root {
          --bg-dark: #0e1a25;
          --bg-card: #152737;
          --accent: #2af598;
          --text-light: #e0f2ff;
        }

        body {
          background: var(--bg-dark);
          color: var(--text-light);
          font-family: 'Roboto', 'Segoe UI', sans-serif;
          display: flex;
          flex-direction: column;
          align-items: center;
          margin: 0;
          height: 100vh;
          padding: 0;
        }

        h1 {
          margin-top: 1rem;
          color: var(--accent);
          font-size: 1.6rem;
          letter-spacing: 1px;
        }

        #grid {
          display: grid;
          grid-template-columns: repeat(4, 1fr); /* ‚úÖ 4 ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏ï‡πà‡∏≠‡πÅ‡∏ñ‡∏ß */
          gap: 1.5rem;
          width: 90%;
          max-width: 1600px;
          margin-top: 1.5rem;
        }

        /* üé® ‡∏Å‡∏•‡πà‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå */
        .card {
          background: var(--bg-card);
          border-radius: 20px;
          padding: 1.5rem;
          text-align: center;
          transition: all 0.3s ease;
          box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
          border: 3px solid transparent;
          height: 340px;
          display: flex;
          flex-direction: column;
          justify-content: space-between; /* ‚úÖ ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏ä‡∏∑‡πà‡∏≠-‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç-‡πÄ‡∏ß‡∏•‡∏≤‡πÅ‡∏¢‡∏Å‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á */
        }

        /* üîπ ‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå (‡∏ö‡∏ô‡∏™‡∏∏‡∏î) */
        .device {
          font-size: 1.2rem;
          color: #9ed0ff;
          margin-bottom: 0.3rem;
          font-weight: 500;
        }

        /* ‚ù§Ô∏è ‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç HR */
        .hr {
          font-size: 10rem;
          font-weight: 800;
          line-height: 1.0;
          transition: color 0.3s;
          margin: 0;
        }

        /* üîπ ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ bpm (‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏ó‡πà‡∏≤‡∏ä‡∏∑‡πà‡∏≠ device) */
        .bpm {
          font-size: 1.2rem;
          color: #9ed0ff;
          margin-top: 0.2rem;
        }

        /* ‚è∞ ‡πÄ‡∏ß‡∏•‡∏≤‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (‡∏•‡πà‡∏≤‡∏á‡∏™‡∏∏‡∏î) */
        .timestamp {
          font-size: 0.9rem;
          color: #89a;
          margin-top: 0.5rem;
        }

    </style>
</head>
<body>
<h1>üíì Polar HR Dashboard</h1>
<div id="grid"></div>

<script>
    const wsUrl = 'wss://polar-hr-monitor-analysis.onrender.com';
    const socket = new WebSocket(wsUrl);

    const devices = {};
    const grid = document.getElementById('grid');

    // ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Å‡∏≤‡∏£‡πå‡∏î 8 ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
    for (let i = 1; i <= 8; i++) {
      const div = document.createElement('div');
      div.className = 'card';
      div.id = 'card' + i;
      div.innerHTML = `
        <div class="device" id="device${i}">Device ${i}</div>
        <div>
          <div class="hr" id="hr${i}">--</div>
          <div class="bpm">bpm</div>
        </div>
        <div class="timestamp" id="time${i}">--</div>
      `;
      grid.appendChild(div);
    }
    // ‡∏™‡∏µ‡∏ï‡∏≤‡∏° HR zone
    function getHrColor(hr) {
      if (hr < 90) return '#3fa9f5';     // blue
      if (hr < 120) return '#00ff99';    // green
      if (hr < 140) return '#f5e642';    // yellow
      if (hr < 170) return '#ff9933';    // orange
      return '#ff3366';                  // red
    }

    socket.onopen = () => console.log('‚úÖ Connected to WebSocket server');

     socket.onmessage = (event) => {
      try {
        const msg = JSON.parse(event.data);
        const hr = msg.hr ?? msg.value;
        const name = msg.deviceName ?? msg.device ?? 'Unknown Device';
        if (!hr) return;

        // üîπ Map device ‚Üí slot (1-8)
        if (!devices[name]) {
          const available = Object.keys(devices).length + 1;
          if (available > 8) return;
          devices[name] = available;
        }

        const idx = devices[name];
        const card = document.getElementById('card' + idx);
        const hrElem = document.getElementById('hr' + idx);
        const devElem = document.getElementById('device' + idx);
        const timeElem = document.getElementById('time' + idx);

        // üîπ ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏•‡πÑ‡∏ó‡∏°‡πå
        devElem.textContent = name;
      //  hrElem.textContent = hr + ' bpm';
        hrElem.textContent = hr;
        hrElem.style.color = getHrColor(hr);
        card.style.borderColor = getHrColor(hr);
        timeElem.textContent = new Date().toLocaleTimeString();
      } catch (err) {
        console.error('‚ùå Error parsing message:', err);
      }
    };


    socket.onclose = () => {
      console.warn('üîå WebSocket closed, retrying...');
      setTimeout(() => location.reload(), 5000);
    };

    socket.onerror = (err) => console.error('‚ö†Ô∏è WebSocket error', err);
</script>
</body>
</html>
